## Stats500 Homework 5
#### *Di Lu, Oct.18, 2017*

### Q1. Based on Chapter 4, Problem 5(p. 97) 
#### 1. build a linear model of taste on Acetic, H2S and Latic

```{r}
library(faraway)
attach(cheddar)
lmod <- lm(taste~Acetic+H2S+Lactic)
summary(lmod)
```

#### 2. Check the constant variance assumption for the errors and for evidence of non-linearity via residual plots, and adjust model as appropriate

Plot residual against fitted values, we can see residuals are roughly symmetrically distributed, and there is no clear evidence of non-linearity. Plot absolute residual against fitted values, and regress abs(redisual) against fitted value, coefficient of fitted value is not significant at 5% level(p=0.2267). We find no clear evidence against constant variance assumption, so we can carry on with this model.
```{r}
par(mfrow=c(1,2))
plot(fitted(lmod),residuals(lmod),xlab="Fitted Values",ylab="Residuals")
abline(h=0) # a diagnostic residual plot
plot(fitted(lmod),abs(residuals(lmod)),xlab="Fitted Values",ylab="|Residuals|")
abline(h=0)
#summary(lm(abs(lmod$residual)~lmod$fitted))
```

#### 3. Check the structure of the relationship between the predictors and response


#### 4. Check the normality assumption
We use QQ-plot to check normality assumption of residuals. Residuals follow the "ideal normal distribution" line approximately, the three largest residuals are above qqline, sending an alarming signal. Shapiro test (p=0.8312) shows not enough evidence to reject normality hypothesis, so we take the normally assumption of this model as true.
```{r}
qqnorm(lmod2$residuals,ylab = "Residuals")
qqline(lmod2$residuals)
shapiro.test(lmod2$residuals)
```

#### 4. Check for large leverage points
We would like to identify unusually large values of the leverage in half-normal plot. We can see obs.20 and 26 diverge slightly farther from the rest of the data. By rule of thumb, we have no data points whose leverages are greater than 2(p+1)/n = 2(3+1)/30=0.266.
On the other hand, studentized residuals adjust residuals to equal variance, thus at higher leverage points can correct natural non-constant variance in residuals
```{r}
par(mfrow=c(1,2))
halfnorm(lm.influence(lmod)$hat,nlab=2,ylab = "Leverage",main="Half-normal plot")
abline(h=2*(5+1)/50)
qqnorm(rstandard(lmod))
abline(0,1)
```

#### 5. Check for outliers
We compute jacknife residuals for the sat data and pick out the largest. By applying Bonferroni correction criteria at a level alpha=5% test(that is 0.05/30 = 0.00167), p-value for largest studentized residuals obs.15 is 0.005817, we don't have enough evidence to reject null hypothes point 15 is an outlier. For other points, we can not reject either.
```{r}
ti<-rstudent(lmod2)
max(abs(ti))
cheddar[which.max(abs(ti)),]
2*(1-pt(max(abs(ti)),df=30-(5+1)-1))
0.05/30
```

#### 5. Check for influential points
Cook distance combines the residual effect and leverage effect, we use it to diagnose influencial points. The obs.15 has largest cook's distance, followed by obs.12 and 30. If we remove obs.15 from regression, we have Lastic coefficient turns significant at 1%.(previously p-value=0.03108) and R-square increased to 0.7083(previously 0.6518).
```{r}
par(mfrow=c(1,2))
cook<-cooks.distance(lmod)
halfnorm(cook,nlab = 3, ylab="Cook's Distance")
inf = lm.influence(lmod)
plot(inf$coef[,2],inf$coef[,3],xlab = "change in beta2", ylab = "change in beta3")
```

